function clearFields(){$("#title").val("");$("#id").val("");$("#allDay").prop("checked",false)}function getCalPath(e,t,n){var r=window.location.protocol+"//"+window.location.host+dirname(window.location.pathname);r+=t?$.fullCalendar.formatDate(e,t)+n:"/"+n;return r}function loadRemote(e){var n=$rdf.graph();var r=$rdf.fetcher(n);$rdf.Fetcher.crossSiteProxyTemplate="https://example.com/proxy?uri={uri}";r.nowOrWhenFetched(e,undefined,function(){t=n;var r=n.statementsMatching(undefined,$rdf.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),undefined,$rdf.sym(e));for(var i in r){var s=n.statementsMatching(r[i]["subject"]);var o=$rdf.Namespace("http://purl.org/NET/c4dm/event.owl#");var u=$rdf.Namespace("http://purl.org/NET/c4dm/timeline.owl#");var a=$rdf.Namespace("http://purl.org/dc/elements/1.1/");var f=$rdf.Namespace("http://xmlns.com/foaf/0.1/");var l=$rdf.Namespace("http://www.w3.org/ns/ui#");var c=r[i]["subject"]["value"];var h=n.anyStatementMatching(r[i]["subject"],u("start"));var p=n.anyStatementMatching(r[i]["subject"],u("end"));var d=n.anyStatementMatching(r[i]["subject"],a("title"));var v=n.anyStatementMatching(r[i]["subject"],l("color"));var m=n.anyStatementMatching(r[i]["subject"],f("maker"));var y=n.anyStatementMatching(r[i]["subject"],u("allDay"));var b={id:c.slice(c.indexOf("#"),c.length),start:h?$.fullCalendar.parseISO8601(h["object"]["value"]):undefined,end:p?$.fullCalendar.parseISO8601(p["object"]["value"]):undefined,allDay:y?true:false,title:d?d["object"]["value"]:undefined,color:v?v["object"]["value"]:undefined,maker:m?m["object"]["value"]:undefined};calEvents.push(b)}render(calEvents)})}function putRemote(e,t){$.ajax({type:"PUT",url:e,contentType:"text/turtle",data:t,processData:false,statusCode:{200:function(){console.log("200 Success")},401:function(){console.log("401 Unauthorized")},403:function(){console.log("403 Forbidden")},406:function(){console.log("406 Contet-type unacceptable")},507:function(){console.log("507 Insufficient storage")}},complete:function(){$("#spinner").hide()}})}function saveEvent(e){$("#editevent").hide();$("#spinner").show();var t=$("#pickerStart").pickadate();var n=t.pickadate("picker").get("highlight");var r=$("#pickerEnd").pickadate();var i=r.pickadate("picker").get("highlight");var s=$("#id").val();var o=$("#title").val();var u=$("#checkedImg").attr("alt");var a=$("#allDay").prop("checked");var f=parseInt($("#startHour").val().slice(0,2))*36e5+parseInt($("#startHour").val().slice(-2));var l=parseInt($("#endHour").val().slice(0,2))*36e5+parseInt($("#endHour").val().slice(-2));var c=parseInt(n.pick)+parseInt(f);c=new Date(parseInt(c));var h=parseInt(i.pick);if(h){h=new Date(h+l)}var p=false;if(s){p=true}else{var d=o+u+a+f+l+c+h;s="#"+hex_sha1(d)}var v={id:s,start:c?c:undefined,end:h?h:undefined,allDay:a,title:o?o:undefined,color:u?u:undefined,maker:mywebid?mywebid:undefined};if(p){for(var m in calEvents){if(calEvents[m].id==s)calEvents.splice(m,1)}}calEvents.push(v);var g=eventsToRDF();if(!e)e=getCalPath(c,undefined,"events");putRemote(e,g);var y=$("#calendar").fullCalendar("getView");$("#calendar").fullCalendar("destroy");render(calEvents);$("#calendar").fullCalendar("changeView",y.name)}function eventsToRDF(){var e=$rdf.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#");var t=$rdf.Namespace("http://purl.org/NET/c4dm/event.owl#");var n=$rdf.Namespace("http://purl.org/NET/c4dm/timeline.owl#");var r=$rdf.Namespace("http://purl.org/dc/elements/1.1/");var i=$rdf.Namespace("http://xmlns.com/foaf/0.1/");var s=$rdf.Namespace("http://www.w3.org/ns/ui#");g=$rdf.graph();for(var o in calEvents){var u=calEvents[o];g.add($rdf.sym(u["id"]),e("type"),t("Event"));g.add($rdf.sym(u["id"]),n("start"),$rdf.lit(u["start"].toISOString(),"",$rdf.Symbol.prototype.XSDdateTime));if(u["end"]){g.add($rdf.sym(u["id"]),n("end"),$rdf.lit(u["end"].toISOString(),"",$rdf.Symbol.prototype.XSDdateTime))}if(u["allDay"]){g.add($rdf.sym(u["id"]),n("allDay"),$rdf.lit(u["allDay"]))}g.add($rdf.sym(u["id"]),r("title"),$rdf.lit(u["title"]));g.add($rdf.sym(u["id"]),s("color"),$rdf.lit(u["color"]));g.add($rdf.sym(u["id"]),i("maker"),$rdf.sym(u["maker"]))}return(new $rdf.Serializer(g)).toN3(g)}function eventToRDF(e,t,n,r,i,s){var o=$rdf.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#");var u=$rdf.Namespace("http://purl.org/NET/c4dm/event.owl#");var a=$rdf.Namespace("http://purl.org/NET/c4dm/timeline.owl#");var f=$rdf.Namespace("http://purl.org/dc/elements/1.1/");var l=$rdf.Namespace("http://xmlns.com/foaf/0.1/");var c=$rdf.Namespace("http://www.w3.org/ns/ui#");g=$rdf.graph();g.add($rdf.sym(e),o("type"),u("Event"));g.add($rdf.sym(e),a("start"),$rdf.lit(i.toISOString(),"",$rdf.Symbol.prototype.XSDdateTime));if(s){g.add($rdf.sym(e),a("end"),$rdf.lit(s.toISOString(),"",$rdf.Symbol.prototype.XSDdateTime))}if(r){g.add($rdf.sym(e),a("allDay"),$rdf.lit(r))}g.add($rdf.sym(e),f("title"),$rdf.lit(t));g.add($rdf.sym(e),c("color"),$rdf.lit(n));g.add($rdf.sym(e),l("maker"),$rdf.sym(mywebid));var h=(new $rdf.Serializer(g)).toN3(g);return h}function updateEvent(e){$("#spinner").show();var t=eventsToRDF();if(!n)var n=getCalPath(e.start,undefined,"events");putRemote(n,t);var r=$("#calendar").fullCalendar("getView");$("#calendar").fullCalendar("destroy");render(calEvents);$("#calendar").fullCalendar("changeView",r.name);$("#spinner").hide()}function deleteEvent(){var e=$("#id").val();$("#editevent").hide();$("#calendar").fullCalendar("removeEvents",[e]);for(var t in calEvents){if(calEvents[t].id==e)calEvents.splice(t,1)}var n=eventsToRDF();if(!r)var r=getCalPath(startDay,undefined,"events");putRemote(r,n);$("#calendar").empty();render(calEvents);return}function render(e){$("#spinner").show();var t=$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},selectable:true,selectHelper:true,eventClick:function(e,t,n){clearFields();$("#id").val(e.id);var r=$.fullCalendar.formatDate(e.start,"ddd, MMMM dd yyyy");var i=!e.end?$.fullCalendar.formatDate(e.start,"ddd, MMMM dd yyyy"):$.fullCalendar.formatDate(e.end,"ddd, MMMM dd yyyy");var s=$("#pickerStart").pickadate();var o=s.pickadate("picker").set("select",$.fullCalendar.parseDate(r));var u=$("#pickerEnd").pickadate();var a=u.pickadate("picker").set("select",$.fullCalendar.parseDate(i));$("#title").val(e.title);setColor(e.color);var f=$.fullCalendar.formatDate(e.start,"HH:mm");if(e.allDay==false&&!e.end){var l=parseInt(f.slice(0,f.indexOf(":")))+1;var l=l+":00"}else if(e.end){var l=$.fullCalendar.formatDate(e.end,"HH:mm")}else{var l="00:00"}$("#timepicker").html("");$("#timepicker").append('<span class="span-left cell inline-block">Event time</span>'+'<div class="left cell inline-block">'+timeSelector("startHour",f)+"</div>");$("#timepicker").append('<div class="left cell inline-block">'+timeSelector("endHour",l)+"</div>");if(e.allDay==true){$("#allDay").prop("checked",true);$("#startHour").prop("disabled",true);$("#endHour").prop("disabled",true)}showEditor(t);$("#title").focus()},select:function(e,t,n,r){clearFields();setColor();startDay=$.fullCalendar.formatDate(e,"ddd, MMMM dd yyyy");endDay=$.fullCalendar.formatDate(t,"ddd, MMMM dd yyyy");var i=$("#pickerStart").pickadate();var s=i.pickadate("picker").set("select",$.fullCalendar.parseDate(e));var o=$("#pickerEnd").pickadate();var u=o.pickadate("picker").set("select",$.fullCalendar.parseDate(t));var a=$.fullCalendar.formatDate(e,"HH:mm");if(n==true||!t){var f=parseInt(a.slice(0,a.indexOf(":")))+1;var l=parseInt(a.slice(a.indexOf(":"),a.length));c=f+":"+l}else{var c=$.fullCalendar.formatDate(t,"HH:mm")}$("#timepicker").html("");$("#timepicker").append('<span class="span-left cell inline-block">Event time</span>'+'<div class="left cell inline-block">'+timeSelector("startHour",a)+"</div>");$("#timepicker").append('<div class="left cell inline-block">'+timeSelector("endHour",c)+"</div>");if(n==true){$("#allDay").prop("checked",true);$("#startHour").prop("disabled",true);$("#endHour").prop("disabled",true)}showEditor(r);$("#title").focus()},eventDrop:function(e,t,n,r,i){if(!confirm("Are you sure about this change?")){i()}else{updateEvent(e)}},eventResize:function(e,t,n,r){if(!confirm("Are you sure about this change?")){r()}else{updateEvent(e)}},editable:true,events:e});$("#spinner").hide()}function showEditor(e){e=window.event||e;var t=$(window).scrollTop()+$(window).height();var n=e.pageY+$("#editevent").height();if(t<=n)var r=t-50-$("#editevent").height();else var r=e.clientY-50;var i=e.clientX-200;$("#editevent").css({top:r+"px",left:i+"px"});$("#editevent").show()}function timeSelector(e,t){if(!t||t=="")t="10:00";var n='<select id="'+e+'" class="'+e+'" name="'+e+'"';n+=e=="startHour"?' onchange="updateHour()">':">";for(i=0;i<=23;i++){if(i<10)i="0"+i;for(j=0;j<2;j++){var r=j==0?"00":"30";var s=i+":"+r;var o=s==t?' selected="selected"':"";n+='<option value="'+s+'" '+o+">"+s+"</option>"}}n+="</select>";return n}function toggleHours(){if($("#allDay").prop("checked")==false){$("#startHour").prop("disabled",false);$("#endHour").prop("disabled",false)}else{$("#startHour").prop("disabled",true);$("#endHour").prop("disabled",true)}}function setColor(e){var t;if(!e)e="#5484ed";switch(e){case"#5484ed":t="Blue";break;case"#e52127":t="Red";break;case"#51b749":t="Green";break;case"#fbd75b":t="Yellow";break;case"#dbadff":t="Purple";break;default:t="Blue"}$("#checkedImg").remove();var n='<img id="checkedImg" class="checkedImg" src="img/checked.png" title="'+t+'" alt="'+e+'" />';$("#"+t).html(n)}function updateHour(){var e=$("#startHour").val();var t=parseInt(e.slice(0,e.indexOf(":")))+1;t=t.toString().length<2?"0"+t:t.toString();var n=e.slice(e.indexOf(":"),e.length);t=t+n;$("#endHour").val(t)}function userInfo(e,t){var n=$rdf.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#");var r=$rdf.Namespace("http://xmlns.com/foaf/0.1/");var i=$rdf.Namespace("http://my-profile.eu/ns/webapp#");var s=$rdf.graph();var o=$rdf.fetcher(s);$rdf.Fetcher.crossSiteProxyTemplate=proxy_template;var u=e.slice(0,e.indexOf("#"));var a=$rdf.sym(e);o.nowOrWhenFetched(u,undefined,function(){mygraph=s;var e=s.any(a,r("name"));var n=s.any(a,r("img"));var i=s.any(a,r("depiction"));if(e==undefined)e="Unknown";else e=e.value;if(e.length>22)e=e.slice(0,18)+"...";if(n==undefined){if(i)n=i.value;else n="https://rww.io/common/images/nouser.png"}else{n=n.value}var o=$('<div class="user left">Welcome, <strong>'+e+'</strong></div><div class="user-pic right"><img src="'+n+'" title="'+e+'" class="login-photo img-border" /></div>');$("#"+t).append(o)})}dirname=function(e){return e.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,"")};var calEvents=[];$(document).bind("keydown",function(e){if(e.keyCode==27){$("#editevent").hide()}})
